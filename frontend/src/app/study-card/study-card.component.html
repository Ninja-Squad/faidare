<h3 *ngIf="study">
  Study {{ study.studyType }}: {{ study.name }}
</h3>

<!-- Loading (see CSS for animation)-->
<div *ngIf="loading" class="lds-spinner mx-auto">
  <div></div>
  <div></div>
  <div></div>
  <div></div>
  <div></div>
  <div></div>
  <div></div>
  <div></div>
  <div></div>
  <div></div>
  <div></div>
  <div></div>
</div>

<!-- Display the map -->
<gpds-map *ngIf="checkLocation(sites)" [sites]="sites"></gpds-map>

<!-- Display the study's info -->
<div class="card" *ngIf="study">
  <div class="card-header">
    Identification
  </div>
  <div class="card-body">
    <div class="row" *ngIf="study.name">
      <div class="col-4 field">
        Name
      </div>
      <div class="col identification-info">
        {{ study.name }}
      </div>
    </div>

    <div class="row row-sep"
         *ngIf="study.studyDbId && puiFilter(study.studyDbId)">
      <div class="col-4 field">
        Identifier
      </div>
      <div class="col identification-info">
        {{ study.studyDbId }}
        <a target="_blank" [href]="studySource['@id']" *ngIf="studySource">
          ( Link to this study on {{ studySource["schema:identifier"] }} )
        </a>
        <!--Will be use when documentationUrl will be set up for source result
        <a target="_blank" [href]="studySource['@schema:documentationURL']">
          ( Link to this study on {{ studySource["schema:identifier"] }} )
        </a>-->
      </div>
    </div>

    <div class="row row-sep" *ngIf="studySource">
      <div class="col-4 field">
        Source
      </div>
      <div class="col identification-info">
        <a target="_blank"
           [href]="studySource['@id']">
          <img [src]="studySource['schema:image']" alt="Study source image"/>
        </a>
      </div>
    </div>

    <div class="row row-sep" *ngIf="studySource">
      <div class="col-4 field">
        Data source
      </div>
      <div class="col">
        <a target="_blank" [href]="studySource['@id']">
          Link to this study on {{ studySource["schema:identifier"] }}
        </a>
      </div>
        </div>

    <div class="row row-sep" *ngIf="studyDataset && studyDataset[0] && studyDataset[0].programName">
      <div class="col-4 field">
        Project name
      </div>
      <div class="col identification-info">
        {{ studyDataset[0].programName }}
      </div>
    </div>

    <div class="row row-sep" *ngIf="study.studyDescription">
      <div class="col-4 field">
        Description
      </div>
      <div class="col identification-info">
        {{ study.studyDescription }}
      </div>
    </div>

    <div class="row row-sep" *ngIf="study.active != null">
      <div class="col-4 field">
        Active
      </div>
      <div class="col identification-info">
        {{ study.active ? "Yes" : "No" }}
      </div>
    </div>

    <div class="row row-sep" *ngIf="study.seasons && study.seasons.length != 0">
      <div class="col-4 field">
        Seasons
      </div>
      <div class="col identification-info">
        <div>
          {{ study.seasons }}
        </div>
      </div>
    </div>

    <div class="row row-sep" *ngIf="study.startDate">
      <div class="col-4 field">
        Date
      </div>
      <div class="col identification-info">
        {{ study.endDate ?
        'From ' + study.startDate + ' to ' + study.endDate  :
        'Started on ' + study.startDate }}
      </div>
    </div>

    <div class="row row-sep" *ngIf="study.location">
      <div class="col-4 field">
        Location name
      </div>
      <div class="col identification-info">
        <a [routerLink]="'/sites/' + study.location.locationDbId">
          {{ study.location.name }}
        </a>
      </div>
    </div>

    <div class="row row-sep" *ngIf="study.dataLinks && study.dataLinks.length != 0">
      <div class="col-4 field">
        Data files
      </div>
      <div class="col identification-info">
        <div class="row" *ngFor="let dataLink of study.dataLinks">
          <a [href]="dataLink.url">
            {{ dataLink.name }}
          </a>
        </div>
      </div>
    </div>


  </div>
</div>

<div class="card" *ngIf="studyGermplasms.length != 0">
  <div class="card-header">
    Genotype
  </div>
  <div class="table-responsive scroll-table germplasm-table">
    <table class="table table-sm table-striped">
      <thead>
      <tr>
        <th scope="col">Accession number</th>
        <th scope="col">Name</th>
        <th scope="col">Taxon</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let germplasm of studyGermplasms">
        <td><a routerLink="/germplasm/{{ germplasm.germplasmDbId }}">{{ germplasm.accessionNumber }}</a></td>
        <td>{{ germplasm.germplasmName }}</td>
        <td>{{ germplasm.genus }} {{ germplasm.species }} {{ germplasm.subtaxa }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="card" *ngIf="studyObservationVariables.length != 0">
  <div class="card-header">
    Variables
  </div>
  <div class="table-responsive scroll-table variables-table">
    <table class="table table-sm table-striped">
      <thead>
      <th scope="col">Variable id</th>
      <th scope="col">Variable short name</th>
      <th scope="col">Variable long name</th>
      <th scope="col">Ontology name</th>
      <th scope="col">Trait description</th>
      </thead>
      <tbody>
      <tr *ngFor="let variable of studyObservationVariables">
        <!--Will replace the setup of the link when documentationURL will be add-->
        <!--<td><a [href]=variable.documentationURL>{{ variable.observationVariableDbId }}</a></td>-->
        <td><a [href]=getVariableLink(variable)>{{ variable.observationVariableDbId }}</a></td>
        <td>{{ variable.name }}</td>
        <td>{{ variable.synonyms[0] }}</td>
        <td>{{ variable.ontologyName }}</td>
        <td>{{ variable.trait.description }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="card" *ngIf="studyDataset.length != 0">
  <div class="card-header">
    Data Set
  </div>
  <div class="table-responsive scroll-table table-sm dataset-table">
    <table class="table table-sm table-striped">
      <thead>
      <th scope="col">Name</th>
      <th scope="col">Type</th>
      <th scope="col">Linked studies identifiers</th>
      </thead>
      <tbody>
      <tr *ngFor="let trial of studyDataset">
        <td>{{ trial.trialName }}</td>
        <td>{{ trial.trialType }}</td>
        <td>{{ getTrialStudies(trial.studies) }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="card" *ngIf="study && study.contacts.length != 0">
  <div class="card-header">
    Contact
  </div>
  <div class="table-responsive scroll-table contact-table">
    <table class="table table-sm table-striped">
      <thead>
      <th scope="col">Role</th>
      <th scope="col">Name</th>
      <th scope="col">Email</th>
      <th scope="col">Institution</th>
      </thead>
      <tbody>
      <tr *ngFor="let contact of study.contacts">
        <td>{{ contact.type }}</td>
        <td>{{ contact.name }}</td>
        <td>{{ contact.email }}</td>
        <td>{{ contact.institutionName }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="card" *ngIf="additionalInfoKeys.length != 0">
  <div class="card-header">
    Additional info
  </div>
  <div class="table-responsive scroll-table additional-info-table">
    <table class="table table-sm table-striped">
      <tbody>
      <tr *ngFor="let key of additionalInfoKeys">
        <td>{{ key }}</td>
        <td>{{ study.additionalInfo[key] }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
