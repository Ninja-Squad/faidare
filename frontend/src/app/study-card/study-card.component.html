
<!-- Loading (see CSS for animation)-->
<gpds-loading-spinner [loading]="loading"></gpds-loading-spinner>

<ng-container *ngIf="study">
<h3>
  Study {{ study.studyType }}: {{ study.name }}
</h3>

<!-- Display the map -->
<gpds-map *ngIf="checkLocation(sites)" [sites]="sites"></gpds-map>

<!-- Display the study's info -->
<gpds-card-section
  header="Identification"
  [test]="study">

  <div class="card-body">

    <gpds-card-row
      label="Name"
      [test]=" study && study.name">
      <div class="col identification-info">
        {{ study.name }}
      </div>
    </gpds-card-row>


    <gpds-card-row
      label="Identifier"
      [test]="study && study.studyDbId && puiFilter(study.studyDbId)">
      <div class="col identification-info">
        {{ study.studyDbId }}
        <a target="_blank" [href]="studySource['@id']" *ngIf="studySource">
          ( Link to this study on {{ studySource["schema:identifier"] }} )
        </a>
        <!--Will be use when documentationUrl will be set up for source result
        <a target="_blank" [href]="studySource['@schema:documentationURL']">
          ( Link to this study on {{ studySource["schema:identifier"] }} )
        </a>-->
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Source"
      [test]="studySource">
      <div class="col identification-info">
        <a target="_blank"
           [href]="studySource['@id']">
          <img [src]="studySource['schema:image']" alt="Study source image"/>
        </a>
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Data source"
      [test]="studySource">
      <div class="col">
        <a target="_blank" [href]="studySource['@id']">
          Link to this study on {{ studySource["schema:identifier"] }}
        </a>
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Project name"
      [test]="studyDataset && studyDataset[0] && studyDataset[0].programName">
      <div class="col identification-info" *ngIf="studyDataset.length != 0">
        <!--studyDataset[0].programName should  be replace by a programName field added in study-->
        {{ studyDataset[0].programName }}
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Description"
      [test]="study && study.studyDescription">
      <div class="col identification-info">
        {{ study.studyDescription }}
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Active"
      [test]="study && study.active != null">
      <div class="col identification-info">
        {{ study.active ? "Yes" : "No" }}
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Seasons"
      [test]="study && study.seasons && study.seasons.length != 0">
      <div class="col identification-info">
        <div>
          {{ study.seasons }}
        </div>
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Date"
      [test]="study && study.startDate">
      <div class="col identification-info">
        {{ study.endDate ?
        'From ' + study.startDate + ' to ' + study.endDate :
        'Started on ' + study.startDate }}
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Location name"
      [test]="study && study.location">
      <div class="col identification-info">
        <a [routerLink]="'/sites/' + study.location.locationDbId">
          {{ study.location.name }}
        </a>
      </div>
    </gpds-card-row>

    <gpds-card-row
      label="Data files"
      [test]="study && study.dataLinks && study.dataLinks.length != 0">
      <div class="col identification-info">
        <div class="row" *ngFor="let dataLink of study.dataLinks">
          <a [href]="dataLink.url">
            {{ dataLink.name }}
          </a>
        </div>
      </div>
    </gpds-card-row>
  </div>
</gpds-card-section>


<gpds-card-section
  header="Genotype"
  [test]="studyGermplasms.length != 0">
  <div class="table-responsive scroll-table germplasm-table">
    <table class="table table-sm table-striped">
      <thead>
      <tr>
        <th scope="col">Accession number</th>
        <th scope="col">Name</th>
        <th scope="col">Taxon</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let germplasm of studyGermplasms">
        <td><a routerLink="/germplasm/{{ germplasm.germplasmDbId }}">{{ germplasm.accessionNumber }}</a></td>
        <td>{{ germplasm.germplasmName }}</td>
        <td>{{ germplasm.genus }} {{ germplasm.species }} {{ germplasm.subtaxa }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</gpds-card-section>


<gpds-card-section
  header="Variables"
  [test]="studyObservationVariables.length != 0">
  <div class="table-responsive scroll-table variables-table">
    <table class="table table-sm table-striped">
      <thead>
      <th scope="col">Variable id</th>
      <th scope="col">Variable short name</th>
      <th scope="col">Variable long name</th>
      <th scope="col">Ontology name</th>
      <th scope="col">Trait description</th>
      </thead>
      <tbody>
      <tr *ngFor="let variable of studyObservationVariables">
        <!--Will replace the setup of the link when documentationURL will be add-->
        <!--<td><a [href]=variable.documentationURL>{{ variable.observationVariableDbId }}</a></td>-->
        <td><a [href]=getVariableLink(variable)>{{ variable.observationVariableDbId }}</a></td>
        <td>{{ variable.name }}</td>
        <td>{{ variable.synonyms[0] }}</td>
        <td>{{ variable.ontologyName }}</td>
        <td>{{ variable.trait.description }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</gpds-card-section>

<gpds-card-section
  header="Data Set"
  [test]="studyDataset.length != 0">
  <div class="table-responsive scroll-table table-sm dataset-table">
    <table class="table table-sm table-striped">
      <thead>
      <th scope="col">Name</th>
      <th scope="col">Type</th>
      <th scope="col">Linked studies identifiers</th>
      </thead>
      <tbody>
      <tr *ngFor="let trial of studyDataset">
        <td>
          <a target="_blank" [href]="getTrialLink(trial)">{{ trial.trialName }}</a>
        </td>
        <td>{{ trial.trialType }}</td>
        <td>{{ getTrialStudies(trial.studies) }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</gpds-card-section>

<gpds-card-section
  header="Contact"
  [test]="study && study.contacts.length != 0">
  <div class="table-responsive scroll-table contact-table">
    <table class="table table-sm table-striped">
      <thead>
      <th scope="col">Role</th>
      <th scope="col">Name</th>
      <th scope="col">Email</th>
      <th scope="col">Institution</th>
      </thead>
      <tbody>
      <tr *ngFor="let contact of study.contacts">
        <td>{{ contact.type }}</td>
        <td>{{ contact.name }}</td>
        <td>{{ contact.email }}</td>
        <td>{{ contact.institutionName }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</gpds-card-section>

<gpds-card-section
  header="Additional info"
  [test]="additionalInfoKeys.length != 0">
  <div class="table-responsive scroll-table additional-info-table">
    <table class="table table-sm table-striped">
      <tbody>
      <tr *ngFor="let key of additionalInfoKeys">
        <td>{{ key }}</td>
        <td>{{ study.additionalInfo[key] }}</td>
      </tr>
      </tbody>
    </table>
  </div>
</gpds-card-section>

</ng-container>

